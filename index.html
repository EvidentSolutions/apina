<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Juha Komulainen">
<title>Apina</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Apina</h1>
<div class="details">
<span id="author" class="author">Juha Komulainen</span><br>
<span id="email" class="email"><a href="mailto:juha.komulainen@evident.fi">juha.komulainen@evident.fi</a></span><br>
<span id="revnumber">version 0.13.4</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_support_for_spring">Support for Spring</a></li>
<li><a href="#_support_for_jackson">Support for Jackson</a>
<ul class="sectlevel2">
<li><a href="#_enums">Enums</a></li>
<li><a href="#_flattening">Flattening</a></li>
<li><a href="#_discriminated_unions">Discriminated unions</a></li>
<li><a href="#_supported_annotations">Supported annotations</a></li>
</ul>
</li>
<li><a href="#_customization_type_mappings">Customization type mappings</a>
<ul class="sectlevel2">
<li><a href="#_configuring_translation">Configuring translation</a></li>
<li><a href="#_configuring_runtime_serialization">Configuring runtime serialization</a></li>
</ul>
</li>
<li><a href="#_customizing_http_requests">Customizing HTTP requests</a>
<ul class="sectlevel2">
<li><a href="#_override_request_handling">Override request handling</a></li>
<li><a href="#_build_urls_without_requests">Build URLs without requests</a></li>
</ul>
</li>
<li><a href="#_gradle_task_reference">Gradle task reference</a></li>
<li><a href="#_translation_details">Translation details</a>
<ul class="sectlevel2">
<li><a href="#_building_the_model">Building the model</a></li>
<li><a href="#_generating_output">Generating output</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apina is a tool for creating client-side TypeScript code automatically from your Spring MVC controllers and Jackson
classes. It analyzes normal Spring / Jackson annotations, builds a model of your API and emits TypeScript code
targeting either Angular or Fetch API.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GitHub</dt>
<dd>
<p><a href="https://github.com/EvidentSolutions/apina" class="bare">https://github.com/EvidentSolutions/apina</a></p>
</dd>
<dt class="hdlist1">Gradle plugin repository</dt>
<dd>
<p><a href="https://plugins.gradle.org/plugin/fi.evident.apina" class="bare">https://plugins.gradle.org/plugin/fi.evident.apina</a></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider the following Spring controller:<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">package hello

@RestController
class HelloController {

    @GetMapping(
    fun greet(@RequestParam name: String) =
        GreetingResponse(greeting = "Hello, $name!", mood = Mood.HAPPY)

    enum class Mood { HAPPY, SAD }

    class GreetingResponse(val greeting: String, val mood: Mood)

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate TypeScript code from the controller, apply Apina&#8217;s Gradle plugin:
<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">plugins {
    id("fi.evident.apina") version "0.13.4"
}

tasks.apina {
    // Output file that Apina generates
    target = File(project(":frontend").projectDir, "gen/apina-api.ts")

    // Generate code for Angular
    platform = Platform.ANGULAR

    // Regex matching our controller classes
    endpoints = listOf("""hello\..+""")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, import generated <code>ApinaModule</code> from your Angular module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">import { ApinaModule } from '../gen/apina-api';

@NgModule({
    imports: [
        ...
        ApinaModule
    ],
    ...
})
class MyModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, inject the service generated by Apina and use it your own code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">import { Component } from "@angular/core";
import { HelloEndpoint, GreetingResponse } from '../gen/apina-api';

@Component({
    selector: 'my-greeting',
    template: `&lt;span *ngIf="response$ | async as response"&gt;{{response.greeting}}&lt;/span&gt;`
})
class MyGreetingComponent {

    readonly response$: Observable&lt;GreetingResponse&gt;;

    constructor(helloEndpoint: HelloEndpoint) {
        this.response$ = helloEndpoint.greet("world");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it! Based on Jackson&#8217;s object mapping rules, Apina generates model types and metadata for
handling JSON serialization on the TypeScript side. Similarly, based on Spring&#8217;s annotations, Apina
generates endpoint classes that execute HTTP requests and marshals the data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_support_for_spring">Support for Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As long as you don&#8217;t do anything too exotic, <code>@RestController</code> -annotated Spring controllers should
just work. Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">package hello

@RestController
@RequestMapping("/topic")
class TopicController {

    @PostMapping("/{topic:[a-zA-Z]+}")
    fun postMessage(@PathVariable topic: String,
                    @RequestBody message: Message,
                    @RequestParam name: String?,
                    response: HttpServletResponse): PostResponse {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a TypeScript class with following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">class TopicEndpoint {

    postMessage(topic: string, message: Message, name: string | null): Observable&lt;PostResponse&gt; {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PathVariable</code>, <code>@RequestBody</code> and <code>@RequestParam</code> parameters are all present in the generated method,
but the <code>response</code> parameter is not, since it makes no sense for the caller to pass that. Also note that
Kotlin&#8217;s nullable type turns into nullable type in TypeScript.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are writing Java instead of Kotlin, you can use nullability annotations
(<code>@Nullable</code>, <code>@CheckForNull</code> etc.) from most well-known libraries to signal nullability
(eg. <code>org.jetbrains:annotations</code> or FindBugs).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_support_for_jackson">Support for Jackson</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jackson is very customizable, but Apina supports only a small statically analyzable subset of Jackson. If
you have customized Jackson mappings heavily in the global configuration, it&#8217;s unlikely that Apina will pick
up your customizations. Same is true if you have used some of Jackson&#8217;s more exotic annotations.</p>
</div>
<div class="paragraph">
<p>Mostly the translation is pretty unsurprising: Apina traverses fields and properties the same way that Jackson
would do and creates matching TypeScript interfaces. However, there are a few things to know:</p>
</div>
<div class="sect2">
<h3 id="_enums">Enums</h3>
<div class="paragraph">
<p>On the wire, enumerations are always represented by their literal name, but there are three different ways that they
can be represented in TypeScript. These can be controlled by setting the <code>enumMode</code> property of the Gradle plugin.</p>
</div>
<div class="paragraph">
<p>So, for following enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">enum class Toggle {
    ON | OFF
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the possible translations would be:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Enum translations</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enum-mode</th>
<th class="tableblock halign-left valign-top">Generated code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enum Toggle { ON = "ON", OFF = "OFF" }</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INT_ENUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enum Toggle { ON, OFF }</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STRING_UNION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type Toggle = "ON" | "OFF"</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Generally you should use the <code>DEFAULT</code> mode if you don&#8217;t have a really good reason to do otherwise.</p>
</div>
</div>
<div class="sect2">
<h3 id="_flattening">Flattening</h3>
<div class="paragraph">
<p>Apina will look for properties in superclasses, but will flatten the result into a single TypeScript interface. So:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">open class Event {
    val timestamp = Instant.now()
}

class LoginEvent(val username: String) : Event()</code></pre>
</div>
</div>
<div class="paragraph">
<p>will turn into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">interface LoginEvent {
    timestamp: Instant
    username: String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First of all, TypeScript is structurally typed so supertypes are not really necessary. And second, keeping
the supertype name available is useful when using <em>discriminated unions</em>:</p>
</div>
</div>
<div class="sect2">
<h3 id="_discriminated_unions">Discriminated unions</h3>
<div class="paragraph">
<p>Apina supports mapping Jackson&#8217;s sub types into TypeScript&#8217;s
<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions">discriminated unions</a> as long
as you use <code>@JsonTypeInfo</code> with <code>use=NAME</code> and specify property name for discriminator. Moreover, you must list
the sub-types and define their discriminator values explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@JsonTypeInfo(use=NAME, property="type")
@JsonSubTypes(
    Type(value = Bar::class, name = "my_bar"),
    Type(value = Baz::class, name = "my_baz")
)
abstract class Foo { ... }

class Bar : Foo() { ... }

class Baz : Foo() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates interfaces normally for <code>Bar</code> and <code>Baz</code> and then adds the following types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">export interface Foo_Bar extends Bar {
    type: "my_bar";
}

export interface Foo_Baz extends Baz {
    type: "my_baz";
}

export type Foo = Foo_Bar | Foo_Baz;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way you can easily pass heterogeneous data back and forth between client and server.</p>
</div>
<div class="sect3">
<h4 id="_kotlin_sealed_classes">Kotlin sealed classes</h4>
<div class="paragraph">
<p>With Java, you must use <code>@JsonSubTypes</code> to find the subtypes of a class, but when using
Kotlin and sealed classes, you don&#8217;t need it. However, you need to use <code>@JsonTypeName</code>
to specify names for the types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@JsonTypeInfo(use=NAME, property="type")
sealed class Foo { ... }

@JsonTypeName("my_bar")
class Bar : Foo() { ... }

@JsonTypeName("my_baz")
class Baz : Foo() { ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_supported_annotations">Supported annotations</h3>
<div class="paragraph">
<p>That said, straightforward Jackson mappings should generally work without hassle. Most of the time you don&#8217;t
need any annotations. When you need to control the mappings, following Jackson annotations are recognized
by Apina as well:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Supported Jackson annotations:</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@JsonIgnore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property is ignored</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@JsonValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties of the owning class will be ignored and the return type of the annotated method will be
used as its representation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@JsonUnwrapped</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties of the target class will be inlined into the referencing class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@JsonTypeInfo</code>, <code>@JsonSubTypes</code>, <code>@JsonTypeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class will be translated into a <em>discriminated union</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Finally, <code>java.beans.Transient</code> can be used as to ignore a property as well.</p>
</div>
<div class="paragraph">
<p>Other annotations are not supported at the moment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization_type_mappings">Customization type mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While most of the time Apina does the right thing without additional configuration,
every now and then you need to customize either the build time translation or
runtime execution.</p>
</div>
<div class="paragraph">
<p>Normally when Apina sees a referenced class, it will analyze its properties and fields
decide how it should be serialized: just like Jackson does. However, for some types
this makes no sense (that is, when Jackson mapping itself is customized).</p>
</div>
<div class="paragraph">
<p>As an example, perhaps you don&#8217;t want <code>java.time.Instant</code> to be serialized as
<code>{ "seconds": 1550778425, "nanos": 398000000" }</code> but would prefer it to be represented
as <code>"2019-02-21T19:47:05.398Z"</code> on the wire. And instead of handling it as a <code>string</code>
in TypeScript, you&#8217;d probably want it to be converted to <code>Date</code> or perhaps
<a href="https://js-joda.github.io/js-joda/">js-joda</a>'s <code>Instant</code>. Apina can do both of these.</p>
</div>
<div class="sect2">
<h3 id="_configuring_translation">Configuring translation</h3>
<div class="paragraph">
<p>First we&#8217;ll configure the Gradle task to <em>import</em> <code>Instant</code> from another file instead
of trying to translate it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.apina {
    ...
    imports = mapOf("./my-apina-types" to listOf("Instant"))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now whenever Apina sees the type <code>Instant</code> (Apina ignores package names) it won&#8217;t try to
generate code for it, but assume that the user has provided it. Furthermore it adds the
code <code>import { Instant } from "./my-apina-types";</code> on top of the generated file.</p>
</div>
<div class="paragraph">
<p>Next, we&#8217;ll write <code>my-apina-types.ts</code>. For our example, we&#8217;ll use JavaScript&#8217;s <code>Date</code>
for representation of <code>Instant</code>, so we&#8217;ll simply specify a type alias:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">export type Instant = Date;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_runtime_serialization">Configuring runtime serialization</h3>
<div class="paragraph">
<p>Next we&#8217;ll need to instruct Apina to customize the serialization format used on JavaScript. (Of
course you also need to configure Jackson similarly, but that&#8217;s out of scope for this document.)
Apina generates an <code>ApinaConfig</code> class whose default constructor will configure all serializers
that Apina can deduce itself. Therefore we can just construct the default instance and then
customize it by registering our own serializer for instants:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">export function createApinaConfig(): ApinaConfig {
    const config = new ApinaConfig();

    config.registerSerializer("Instant", {
        serialize(o) { return formatISO8601(o); },
        deserialize(o) {Â return parseISO8601(o); }
    });

    return config;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we&#8217;ll register <code>createApinaConfig</code> as a factory for <code>ApinaConfig</code> in our Angular module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">@NgModule({
    ...
    providers: [
        { provide: ApinaConfig, useFactory: createApinaConfig }
    ]
})
export class MyModule { }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When generating code for ES6, you won&#8217;t register the provider for Angular, but you&#8217;ll
simply pass configuration as a constructor parameter when instantiating endpoint-classes.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_http_requests">Customizing HTTP requests</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_override_request_handling">Override request handling</h3>
<div class="paragraph">
<p>Sometimes you need more control over the HTTP requests Apina makes. Perhaps
you are behind a proxy and need to mangle the URL somehow or perhaps you&#8217;ll want
to add some headers to requests.</p>
</div>
<div class="paragraph">
<p>You can implement these by implementing replacing Apina&#8217;s <code>ApinaEndpointContext</code>
with your own. When Apina generates code for endpoints, it actually just builds
a structure representing the details of the request and passes it to endpoint
context for actual execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">findOrders(customerId: number): Observable&lt;Order&gt; {
    return this.context.request({
        'uriTemplate': '/api/customer/{customerId}/orders',
        'method': 'GET',
        'pathVariables': {
            'customerId': this.context.serialize(customerId, 'number')
        },
        'responseType': 'Order'
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore, you can easily implement your own endpoint context that does something
different than the default one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">@Injectable()
export class MyApinaEndpointContext extends ApinaEndpointContext {

    constructor(config: ApinaConfig) {
        super(config);
    }

    request(data: RequestData): Observable&lt;any&gt; {
        ... do something completely different ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, register it so that Apina uses it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">@NgModule({
    ...
    providers: [
        { provide: ApinaEndpointContext, useClass: MyApinaEndpointContext }
    ]
})
export class MyModule { }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When targeting ES6, you can just instantiate your own context normally and
pass it to constructor of your endpoint class.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When targeting Angular, Apina&#8217;s <code>DefaultApinaEndpointContext</code> uses Angular&#8217;s
<code>HttpClient</code> to execute the requests. Therefore things like authorization headers
are probably best implemented as interceptors for <code>HttpClient</code> instead of writing an
Apina-specific implementation. Custom endpoint context can still be useful for
some cases which need higher-level knowledge of the requests.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_build_urls_without_requests">Build URLs without requests</h3>
<div class="paragraph">
<p>It&#8217;s also possible to configure Apina to build methods that simply return the
request URL without making a request. This could be used for a strongly typed
download link or performing really exotic requests while still getting help
from Apina.</p>
</div>
<div class="paragraph">
<p>Suppose we have following controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">package example

@RestController
class DownloadController {

    @GetMapping("/download/{name}")
    fun download(@PathVariable name: String, @RequestParam code: Int): Document {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now configure a regex matching to the fully qualified name of the method to
tell Apina that we want URL-generation for this method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.apina {
    endpointUrlMethods = listOf("""hello\.DownloadController\.download""")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Apina creates two methods instead of one. First you can use to call the endpoint
as normally, whereas you can use one with <code>Url</code>-suffix to create the URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-typescript" data-lang="typescript">interface DownloadEndpoint {
    download(name: String, code: Int): Observable&lt;Document&gt;;
    downloadUrl(name: String, code: Int): string;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Methods with <code>@RequestBody</code> parameter are supported, but they are omitted from the
URL-method, since it&#8217;s impossible to create a URL with request body. In that case,
you need to  pass the body manually when you end up calling the URL.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_task_reference">Gradle task reference</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">plugins {
    id("fi.evident.apina") version "0.13.4"
}

tasks.apina {
    // Set the name of the created TypeScript file. Default is "build/apina/apina.ts".
    target = File(project(":frontend").projectDir, "app/apina-api.ts")

    // Specify types that should not be generated, but are implemented manually
    // and should be imported to the generated code. Keys are module paths, values
    // are list of types imported from the module.
    imports = mapOf(
      "./my-time-module" to listOf("Instant", "LocalDate"),
      "./other-module" to listOf("Foo", "Bar")
    )

    // How Java enums are translated to TypeScript enums? (Default mode is 'DEFAULT'.)
    //  - 'DEFAULT'      =&gt; enum MyEnum { FOO = "FOO", BAR = "BAR", BAZ = "BAZ" }
    //  - 'INT_ENUM'     =&gt; enum MyEnum { FOO, BAR, BAZ }
    //  - 'STRING_UNION' =&gt; type MyEnum = "FOO" | "BAR" | "BAZ"
    enumMode = EnumMode.DEFAULT

    // Which controllers to include when generating API? Defaults to everything.
    // Given regexes may safely match other things that are not controllers, but it pays to
    // limit the scope because otherwise Apina needs to parse bytecode of all the classes
    // in your classpath to find the controllers.
    endpoints = listOf("""my\.package\.foo\..+""")

    // Which methods to include when generating URL methods. This is a subset of normal
    // endpoint methods. Pattern to match is 'package.name.ClassName.methodName'. By
    // default this set is empty and no URL-methods are generated.
    endpointUrlMethods = listOf(""".+\.download.*""")

    // If generated URLs would start with given prefix, removes it. Useful when configuring Apina
    // to work behind reverse proxies. Defaults to empty string (URL is not modified).
    removedUrlPrefix = "/foo"

    // Code generation target (Default is 'ANGULAR')
    // - 'ANGULAR' =&gt; Generate Angular module that uses Angular's HttpClient
    // - 'ES6' =&gt; Generate code that uses Fetch API and has no dependencies apart from ES6
    platform = Platform.ANGULAR
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_translation_details">Translation details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections provide a bird&#8217;s eye view of the translation process. It&#8217;s not necessary
to understand this in order to use Apina, but it&#8217;s probably a good idea anyway.</p>
</div>
<div class="sect2">
<h3 id="_building_the_model">Building the model</h3>
<div class="paragraph">
<p>Apina starts by building its model, the <em>API Definition</em>. API Definition contains information about
HTTP endpoints and JSON documents that need translation. The model itself is agnostic to any specific
technology, so in theory you could have a parser that builds a model out of a .NET or Rust program.
However, only Spring MVC and Jackson are supported at the moment.</p>
</div>
<div class="paragraph">
<p>The process to build a model from Spring MVC application is straightforward:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find all controllers annotated with <code>@RestController</code>.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup> Add these as endpoint groups.</p>
</li>
<li>
<p>Scan their <code>@RequestMapping</code>-annotated methods (you can use meta such as <code>@GetMapping</code> etc). Add
these as endpoints to endpoint groups.</p>
</li>
<li>
<p>Perform Jackson-scanning for <code>@RequestBody</code> parameters and return type of the methods:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Build a <em>Class Definition</em>, <em>Enum Definition</em> or <em>Discriminated Union Definition</em> based on the Java type
and its Jackson annotations.</p>
</li>
<li>
<p>Go through all properties that Jackson would consider and add them to the definition.</p>
</li>
<li>
<p>Perform the scanning process recursively on the types of the properties.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_generating_output">Generating output</h3>
<div class="paragraph">
<p>When the model has been built, Apina creates output:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each type definition in the model, create corresponding TypeScript elements:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>An interface describing the structure of the data</p>
</li>
<li>
<p>Configuration metadata for client-side object-mapper</p>
</li>
</ol>
</div>
</li>
<li>
<p>For each endpoint group (Spring MVC controller), create an endpoint class.</p>
</li>
<li>
<p>Write some generic runtime code that is independent of translated classes (e.g.
implementation of object mapper and some support code for making requests)</p>
</li>
<li>
<p>Write target specific code</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a default <code>EndpointContext</code>-implementation for Angular or ES6</p>
</li>
<li>
<p>If using Angular, create Angular module that wires all generated endpoint classes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since the model of the API is completely abstract from the implementation technology, in theory we could
proceed to generate code for any target, e.g. Swift or Befunge. However, at the moment only TypeScript is
supported, albeit with two different flavors: we can generate code that takes advantage of Angular&#8217;s offerings
or we can generate code for standalone ES6, using the Fetch API for requests.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Throughout the documentation I&#8217;ve used Kotlin for brevity, but Apina works perfectly with Java as well.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Again this is Kotlin, but using Groovy is similar enough.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. As far as Spring is concerned, <code>@RestController</code> is just a combination of <code>@Controller</code> and <code>@ResponseBody</code> annotations. Apina ignores controllers annotated with <code>@Controller</code> for a reason: this way it&#8217;s easy to make controllers that Apina ignores.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.13.4<br>
Last updated 2019-03-05 12:49:33 +0200
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>